# Image configuration for the NVIDIA device plugin
image:
  repository: nvcr.io/nvidia/k8s-device-plugin
  pullPolicy: IfNotPresent

# Namespace for deployment
namespaceOverride: "nvidia"

# Ensure the plugin is scheduled on GPU-enabled nodes
nodeSelector:
  nvidia.com/gpu.present: "true"

# # Tolerations to allow scheduling on GPU nodes with common taints
tolerations:
  - key: "nvidia.com/gpu"
    operator: "Exists"
    effect: "NoSchedule"

# Enable the device plugin (required)
devicePlugin:
  enabled: true
  args:
    - "--log-level=debug"
  securityContext:
    privileged: true

# Disable optional components (GFD and NFD) for minimal deployment
gfd:
  enabled: true
  securityContext:
    privileged: true
nfd:
  enabled: true



# Basic resource configuration (adjust as needed for your environment)
resources:
  limits:
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Ensure compatibility with Kubernetes critical add-ons
priorityClassName: "system-node-critical"

config:
  map:
    default: |-
      version: v1
      flags:
        migStrategy: "none"
        failOnInitError: false
        nvidiaDriverRoot: "/"
        nvidiaDevRoot: "/dev"
        deviceDiscoveryStrategy: "tegra"
        plugin:
          passDeviceSpecs: true
          deviceListStrategy: ["envvar"]
          deviceIDStrategy: "uuid"
          nvidiaCTKPath: "/usr/bin/nvidia-ctk"
          containerDriverRoot: "/var/run/nvidia"
        mpsRoot: "/tmp/nvidia-mps"

# Disable MPS (Multi-Process Service) for simplicity
mps:
  enabled: false