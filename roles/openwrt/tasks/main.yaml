
- name: Update package list
  ansible.builtin.raw: opkg update

# Cannot use ansible.builtin.opkg until python is installed.
# python3-multiprocessing python3-distutils python3-logging
# python3-urllib
- name: Install required packages for ansible on OpenWrt
  ansible.builtin.raw: |-
    opkg install {{ item }}
  loop:
    - openssh-sftp-server
    - coreutils-base64
    - python3
    - python3-multiprocessing
    - python3-distutils
    - python3-logging
    - python3-urllib
  tags:
    - ansible
    - packages

# - name: Wireguard VPN setup
#   include_tasks: vpn.yaml
#   vars:
#     ansible_user: root
#     wireguard_port: 51820
#     vpn_network: "10.0.0.0/24"
#     server_ip: "10.0.0.1"
#     # can be generated with: openssl rand -base64 20 | base32 -w 0 | tr -d '='
#     totp_secret: "{{ vault_totp_secret }}"
#   tags:
#     - wireguard
#     - networking
#     - packages

- name: Update networking
  include_tasks: update-networking.yaml
  tags:
    - networking
    - wireguard

- name: Update hosts
  include_tasks: update-hosts.yaml
  tags:
    - dhcp
    - hosts

- name: Update inventories
  include_tasks: update-inventories.yaml
  tags:
    - inventories

- name: Update DDNS
  include_tasks: update-ddns.yaml
  tags:
    - ddns

- name: Update ssl-certs
  include_tasks: update-acme.yaml
  tags:
    - ssl
    - acme
